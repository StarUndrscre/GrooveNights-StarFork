<ActorFrame InitCommand="%function(self)
	if GAMESTATE:IsHumanPlayer(PLAYER_1) then
 		DoCustomMod('Foreground', PLAYER_1, {} )
	else
		DoCustomMod('Foreground', PLAYER_2, {} )
	end
	if GAMESTATE:GetEnv('Vibrate') == 'On' then
		self:vibrate();
	end
end"> <children>
    
<Layer Type="Quad"
	OnCommand="%function(self) self:diffusealpha(0); InitScreen('ScreenGameplay'); end"
/>
	<Layer
		Type="Quad"
		Condition="gnPlayerPositioning == 2 and GAMESTATE:GetNumSidesJoined() == 2"
		OnCommand="hidden,1;queuecommand,Ready"
		ReadyCommand="%function(self)
			SCREENMAN:GetTopScreen():GetChild('PlayerP1'):GetChild('Judgment'):x(-180)
			SCREENMAN:GetTopScreen():GetChild('PlayerP1'):GetChild('Combo'):x(-180)
			SCREENMAN:GetTopScreen():GetChild('PlayerP2'):GetChild('Judgment'):x(180)
			SCREENMAN:GetTopScreen():GetChild('PlayerP2'):GetChild('Combo'):x(180)
		end"
	/>
		
	<!--Scrape the Player's Score-->
	<BitmapText
		Condition="GAMESTATE:GetPlayMode() ~= PLAY_MODE_ONI"
		Text=""
		File="_eurostile blue glow"
		InitCommand="%function(self)
			self:x(SCREEN_CENTER_X);
			self:y(SCREEN_CENTER_Y);
		end"
		StepP1MessageCommand="%function(self)
			gnScoreP1 = SCREENMAN:GetTopScreen():GetChild('ScoreP1'):GetChild('ScoreDisplayPercentage Percent'):GetChild('PercentP1'):GetText();
			gnScoreP1 = string.gsub(gnScoreP1,'%%','');
			gnScoreP1 = tonumber(gnScoreP1);
		end"
		StepP2MessageCommand="%function(self)
			gnScoreP2 = SCREENMAN:GetTopScreen():GetChild('ScoreP2'):GetChild('ScoreDisplayPercentage Percent'):GetChild('PercentP2'):GetText();
			gnScoreP2 = string.gsub(gnScoreP2,'%%','');
			gnScoreP2 = tonumber(gnScoreP2);
		end"
		
		ScreenTransitionMessageCommand="%function(self)
			if GAMESTATE:IsPlayerEnabled(PLAYER_1) then
				gnScoreP1 = SCREENMAN:GetTopScreen():GetChild('ScoreP1'):GetChild('ScoreDisplayPercentage Percent'):GetChild('PercentP1'):GetText();
				gnScoreP1 = string.gsub(gnScoreP1,'%%','');
				gnScoreP1 = tonumber(gnScoreP1);
			end

			if GAMESTATE:IsPlayerEnabled(PLAYER_2) then
				gnScoreP2 = SCREENMAN:GetTopScreen():GetChild('ScoreP2'):GetChild('ScoreDisplayPercentage Percent'):GetChild('PercentP2'):GetText();
				gnScoreP2 = string.gsub(gnScoreP2,'%%','');
				gnScoreP2 = tonumber(gnScoreP2);
			end
		end"
	/>


		
		<ActorFrame InitCommand="x,SCREEN_CENTER_X+89">
			<children>
	<!--Total PlayTime-->
			<BitmapText
				Text=""
				File="_eurostile blue glow"
				Condition="PlayTimeEnabled()"
				InitCommand="@'diffuse,'..LabelColor()"
				OnCommand="%function(self)
				self:x(-112);
				self:y(SCREEN_BOTTOM-10);
				self:zoom(0.6);
				self:shadowlength(0);
				self:horizalign('Right');
					self:settext('Total PlayTime');
				end"
			/>
	<!--Total PlayTime Variables-->
			<BitmapText
				Text=""
				File="_eurostile blue glow"
				Condition="PlayTimeEnabled()"
				OnCommand="%function(self)  self:x(-102) self:zoom(0.6); self:shadowlength(0) self:draworder(10000); self:y(SCREEN_BOTTOM-10); self:queuecommand('Update'); self:horizalign('left'); end"
				UpdateCommand="%function(self)
				gnPlaySec = gnPlaySec + 1;
				if gnPlaySec >= 60 then
					gnPlaySec = 0;
					gnPlayMin = gnPlayMin + 1;
					end
				if gnPlayMin >= 60 then
					gnPlayMin = 0;
					gnPlayHour = gnPlayHour + 1;
					end
					
				if gnPlaySec < 10 then
					gnPlaySecText = '0'..gnPlaySec
					else
					gnPlaySecText = ''..gnPlaySec
					end
				if gnPlayMin < 10 then
					gnPlayMinText = '0'..gnPlayMin
					else
					gnPlayMinText = ''..gnPlayMin
					end
				if gnPlayHour < 10 then
					gnPlayHourText = '0'..gnPlayHour
					else
					gnPlayHourText = ''..gnPlayHour
					end
					
				self:settext(gnPlayHourText..':'..gnPlayMinText..':'..gnPlaySecText);
				self:sleep(1);
				self:queuecommand('Update');
				end"
			/>
	<!--Song Count-->
			<BitmapText
				Text=""
				File="_eurostile blue glow"
				Condition="PlayTimeEnabled()"
				InitCommand="%function(self)  self:x(-32) self:zoom(0.6); self:shadowlength(0) self:draworder(10000); self:y(SCREEN_BOTTOM-10); self:horizalign('left'); end"
				OnCommand="%function(self)
				self:stoptweening();
				if gnSongCount == nil then
					gnSongCount = 0;
					end
				
				if gnSongCount == 1 then
					self:settext('('..gnSongCount..' Song)');
					else
					self:settext('('..gnSongCount..' Songs)');
					end
				end"
			/>
			</children>
		</ActorFrame>
		
<!-- Crowns -->
<ActorFrame Condition="GAMESTATE:IsHumanPlayer(PLAYER_1) and GAMESTATE:IsHumanPlayer(PLAYER_2)"><children>
<Layer File="winning"
	InitCommand="diffusealpha,0;x,SCREEN_CENTER_X-(SCREEN_WIDTH*296/640)-9;y,SCREEN_CENTER_Y-111;zoom,0.5;rotationz,-30"
	OnCommand="%function(self) DoEasterEgg('GoodLuckCameron', { Actor = self }) self:queuecommand('Update'); end"
	StepP1MessageCommand="%function(self) self:stoptweening(); self:queuecommand('Update'); end"
	StepP2MessageCommand="%function(self) self:stoptweening(); self:queuecommand('Update'); end"
	UpdateCommand="%function(self) if gnScoreP1 >= gnScoreP2 then self:linear(0.2); self:diffusealpha(1); else self:linear(0.2); self:diffusealpha(0); end end"
/>
<Layer File="winning"
	InitCommand="diffusealpha,0;x,SCREEN_CENTER_X+(SCREEN_WIDTH*296/640)+7;y,SCREEN_CENTER_Y-111;zoom,0.5;rotationz,30"
	OnCommand="%function(self) DoEasterEgg('GoodLuckCameron', { Actor = self }) self:queuecommand('Update'); end"
	StepP1MessageCommand="%function(self) self:stoptweening(); self:queuecommand('Update'); end"
	StepP2MessageCommand="%function(self) self:stoptweening(); self:queuecommand('Update'); end"
	UpdateCommand="%function(self) if gnScoreP2 >= gnScoreP1 then self:linear(0.2); self:diffusealpha(1); else self:linear(0.2); self:diffusealpha(0); end end"
/>
</children></ActorFrame>

<!--Custom BPM Display-->
<ActorFrame><children>
	<LayerType="BitmapText"
		Font="Journey"
		Text="@GetRateMod()"
		Condition="not GAMESTATE:IsDemonstration()"
		InitCommand="x,-1000;shadowlength,0;sleep,0.01;queuecommand,Ready"
		ReadyCommand="%function(self) 
			SCREENMAN:GetTopScreen():GetChild('BPMDisplay'):addy(-10000);
			FinalBPM = tonumber(SCREENMAN:GetTopScreen():GetChild('BPMDisplay'):GetChild('Text'):GetText());
			self:settext(FinalBPM);
			self:x(SCREEN_CENTER_X-1);
			self:y(SCREEN_TOP-44);
			self:zoom(1.1);
			self:horizalign('center');
			self:addy(100);
			if OPENITG then 
				self:queuecommand('OITGUpdate'); 
			else
				self:queuecommand('OtherUpdate')
			end
		end"
		OITGUpdateCommand="%function(self)
			FinalBPM = tonumber(SCREENMAN:GetTopScreen():GetChild('BPMDisplay'):GetChild('Text'):GetText());
			if FinalBPM <= math.ceil(highBPM*curRate) then

			else
				if FinalBPM >= math.floor(lowBPM*curRate) then
				
				else
					FinalBPM = math.ceil(highBPM*curRate)
				end
			end
			self:settext(FinalBPM);
			self:sleep(0.1);
			self:queuecommand('OITGUpdate');
		end"
		OtherUpdateCommand="%function(self)
			FinalBPM = tonumber(SCREENMAN:GetTopScreen():GetChild('BPMDisplay'):GetChild('Text'):GetText());
			FinalBPM = math.ceil(FinalBPM*curRate)
			self:settext(FinalBPM);
			self:sleep(0.1);
			self:queuecommand('OtherUpdate');		
		end"
		OffCommand="accelerate,0.8;addy,-100"
	/>

</children></ActorFrame>


<!--Default Stuff-->
	<Layer Type="ActorFrame"
		OnCommand="x,SCREEN_CENTER_X;y,SCREEN_TOP+24;sleep,0.5;queuecommand,TweenOn"
		OffCommand="queuecommand,TweenOff"
		ShowGameplayTopFrameMessageCommand="playcommand,TweenOn"
		HideGameplayTopFrameMessageCommand="playcommand,TweenOff"
		TweenOnCommand=""
		TweenOffCommand=""
		> <children>
		
		<Layer File="meter measure" OnCommand="@'diffuse,'..FrameColor()..';'" />
		
		<Layer
			Type="SongMeterDisplay"
			StreamWidth="390"
			StreamPath="meter stream"
			OnCommand="@'diffuse,'..LifeMeterColor(2)..';diffusealpha,0.75;blend,add;sleep,0.1'"
			CheckCommand="%function(self) self:stoptweening(); MESSAGEMAN:Broadcast('TipX'); self:sleep(0.1); self:queuecommand('Check'); end"
		>
			<Tip
				File="tip"
				OnCommand="@'diffuse,'..SongMeterColor()"
			/>
		</Layer>

		<Layer File="meter frame" OnCommand="@'diffuse,'..FrameColor()..';'" />

		<Layer
			Type="BitmapText"
			Font="_eurostile normal"
			OnCommand="y,0;zoom,.6;"
			InitCommand="shadowlength,0;animate,0;playcommand,Update"
			CurrentSongChangedMessageCommand="playcommand,Update"
			UpdateCommand="%SetFromSongTitleAndCourseTitle"
		/>
	</children> </Layer>

	<!-- Difficulty: -->
	<Layer Type="ActorFrame"
		OnCommand="sleep,0.5;queuecommand,TweenOn"
		OffCommand="queuecommand,TweenOff"
		ShowGameplayTopFrameMessageCommand="playcommand,TweenOn"
		HideGameplayTopFrameMessageCommand="playcommand,TweenOff"
		> <children>
		
		<ActorFrame Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1) and not GAMESTATE:IsCourseMode();" OnCommand="x,SCREEN_CENTER_X-(SCREEN_WIDTH*264/640);y,SCREEN_TOP+25;" TweenOnCommand="" TweenOffCommand=""><children>
			<Actor
				File="@THEME:GetPath(EC_GRAPHICS,'','_difficulty icons')"
				OnCommand="animate,0;playcommand,Update"
				CurrentStepsP1ChangedMessageCommand="playcommand,Update"
				CurrentStepsP2ChangedMessageCommand="playcommand,Update"
				UpdateCommand="%function(self,parent) SetDifficultyFrameFromSteps(self, PLAYER_1) end"
			/>
			<BitmapText
					Text="@GetCurrentSongDifficulty(PLAYER_1)"
					File="_eurostile normal"
					OnCommand="%function(self) 
					self:shadowlength(0);
					self:horizalign('center')
					self:zoom(0.5);
					self:x(-12);
					self:y(-1);
					end"
			/>
			<BitmapText
					Text="@GetCurrentSongMeter(PLAYER_1)"
					File="_eurostile normal"
					OnCommand="%function(self) 
					self:shadowlength(0);
					self:horizalign('center')
					self:zoom(0.5);
					self:x(33);
					self:y(-1);
					end"
			/>
			<Actor
				File="@THEME:GetPath(EC_GRAPHICS,'','_difficulty frame F')"
				OnCommand="@'diffuse,'..FrameColor()..';'"
			/>
		</children></ActorFrame>
		
		<ActorFrame Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1) and GAMESTATE:IsCourseMode();" OnCommand="x,SCREEN_CENTER_X-(SCREEN_WIDTH*264/640);y,SCREEN_TOP+25;" TweenOnCommand="" TweenOffCommand=""><children>
			<Actor
				File="@THEME:GetPath(EC_GRAPHICS,'','_difficulty icons')"
				OnCommand="animate,0;playcommand,Update"
				CurrentStepsP1ChangedMessageCommand="playcommand,Update"
				CurrentStepsP2ChangedMessageCommand="playcommand,Update"
				UpdateCommand="%function(self,parent) SetDifficultyFrameFromSteps(self, PLAYER_1) end"
			/>
					<Actor
				Class="DifficultyMeter"
				Type="ScreenGameplay DifficultyMeterP1"
				OnCommand="playcommand,Update"
				UpdateCommand="%function(self) 
						if GAMESTATE:GetCurrentTrail(PLAYER_1) then 
							self:SetFromTrail(GAMESTATE:GetCurrentTrail(PLAYER_1)) 
						else
							self:SetFromSteps(GAMESTATE:GetCurrentSteps(PLAYER_1))
						end
					end"
			/>
			<Actor
				File="@THEME:GetPath(EC_GRAPHICS,'','_difficulty frame F')"
				OnCommand="@'diffuse,'..FrameColor()..';'"
			/>
		</children></ActorFrame>
		
		<ActorFrame Condition="GAMESTATE:IsPlayerEnabled(PLAYER_2) and not GAMESTATE:IsCourseMode();" OnCommand="x,SCREEN_CENTER_X+(SCREEN_WIDTH*263/640);y,SCREEN_TOP+25;" TweenOnCommand="" TweenOffCommand=""><children>
			<Actor
				File="@THEME:GetPath(EC_GRAPHICS,'','_difficulty icons')"
				OnCommand="zoomx,-1;animate,0;playcommand,Update"
				CurrentStepsP1ChangedMessageCommand="playcommand,Update"
				CurrentStepsP2ChangedMessageCommand="playcommand,Update"
				UpdateCommand="%function(self,parent) SetDifficultyFrameFromSteps(self, PLAYER_2) end"
			/>
			<BitmapText
					Text="@GetCurrentSongDifficulty(PLAYER_2)"
					File="_eurostile normal"
					OnCommand="%function(self) 
					self:shadowlength(0);
					self:horizalign('center')
					self:zoom(0.5);
					self:x(13);
					self:y(-1);
					end"
			/>
			<BitmapText
					Text="@GetCurrentSongMeter(PLAYER_2)"
					File="_eurostile normal"
					OnCommand="%function(self) 
					self:shadowlength(0);
					self:horizalign('center')
					self:zoom(0.5);
					self:x(-32);
					self:y(-1);
					end"
			/>
			<Actor
				File="@THEME:GetPath(EC_GRAPHICS,'','_difficulty frame F')"
				OnCommand="@'diffuse,'..FrameColor()..';rotationy,180;'"
			/>
		</children></ActorFrame>
		
		<ActorFrame Condition="GAMESTATE:IsPlayerEnabled(PLAYER_2) and GAMESTATE:IsCourseMode();" OnCommand="x,SCREEN_CENTER_X+(SCREEN_WIDTH*263/640);y,SCREEN_TOP+25;" TweenOnCommand="" TweenOffCommand=""><children>
			<Actor
				File="@THEME:GetPath(EC_GRAPHICS,'','_difficulty icons')"
				OnCommand="animate,0;rotationy,180;"
			/>
					<Actor
				Class="DifficultyMeter"
				Type="ScreenGameplay DifficultyMeterP2"
				OnCommand="playcommand,Update"
				UpdateCommand="%function(self) 
						if GAMESTATE:GetCurrentTrail(PLAYER_2) then 
							self:SetFromTrail(GAMESTATE:GetCurrentTrail(PLAYER_2)) 
						else
							self:SetFromSteps(GAMESTATE:GetCurrentSteps(PLAYER_2))
						end
					end"
			/>
			<Actor
				File="@THEME:GetPath(EC_GRAPHICS,'','_difficulty frame F')"
				OnCommand="@'diffuse,'..FrameColor()..';rotationy,180;'"
			/>
		</children></ActorFrame>
	</children> </Layer>


	<!-- Draw on top of the rest -->
	<Layer
		Type="Quad"
		OnCommand="diffuse,#000000;stretchto,SCREEN_LEFT,SCREEN_TOP,SCREEN_RIGHT,SCREEN_BOTTOM;diffusealpha,1;linear,0.1;diffusealpha,0"
	/>

	<!-- Finally we can find out where a song is located if it plays on the Demo Screen -->
	<Layer
		Condition="GAMESTATE:IsDemonstration()"
		File="../_song credit display"
		OnCommand=""
	/>

	<!-- Demonstration only: -->
	<Layer Class="ActorFrame" Condition="GAMESTATE:IsDemonstration()"><children>
		<Layer
			File="demonstration gradient"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;zoomtowidth,SCREEN_WIDTH;zoomtoheight,SCREEN_HEIGHT;diffusealpha,0.8"
		/>
		<Layer
			File="demonstration logo"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-184;pulse;EffectMagnitude,1.0,0.9,0;effectclock,bgm;effectperiod,1"
		/>
	</children></Layer>

	
	
	<!-- Easter Eggs -->
	<!--Summer Rain, I made this chart so I don't need to credit myself (oops)-->
	<ActorFrame Condition="EasterEggSummerRain()"><children>
	<Layer
	File="easter_eggs/rainnear"
	OnCommand="x,320*gnScaleWidth;y,240*gnScaleHeight;customtexturerect,0,0,1,1;texcoordvelocity,0.00,-1.00;ZoomToWidth,640*gnScaleWidth;ZoomToHeight,480*gnScaleHeight;diffusealpha,0;linear,1;diffusealpha,1;"
	/>

	<Layer
	File="easter_eggs/rainmed"
	OnCommand="x,320*gnScaleWidth;y,240*gnScaleHeight;rotationz,5;customtexturerect,0,0,1,1;texcoordvelocity,0.00,-0.80;ZoomToWidth,640*gnScaleWidth;ZoomToHeight,480*gnScaleHeight;diffusealpha,0;linear,1;diffusealpha,1;"
	/>

	<Layer
	File="easter_eggs/rainfar"
	OnCommand="x,320*gnScaleWidth;y,240*gnScaleHeight;rotationz,-5;customtexturerect,0,0,1,1;texcoordvelocity,0.00,-0.6;ZoomToWidth,640*gnScaleWidth;ZoomToHeight,480*gnScaleHeight;diffusealpha,0;linear,1;diffusealpha,1;"
	/>

	<Layer
	File="easter_eggs/rainClouds"
	OnCommand="x,320*gnScaleWidth;y,240*gnScaleHeight;zoomx,1*gnScaleWidth;zoomy,1*gnScaleHeight;diffusealpha,0;linear,1.000;diffusealpha,1;"
	/>

	</children></ActorFrame>





	<!-- Santa: Credit to Kytsune and his Little Pleasures Chart -->
	<ActorFrame Condition="EasterEggSanta()"> <children>
	<layer
		File="easter_eggs/receptor"
		OnCommand="x,PlayerPosP1()-96;y,SCREEN_CENTER_Y-125;rotationz,90;diffuseblink;effectcolor1,1,0,0,0.5;effectcolor2,0,1,0,0.5;effectclock,bgm;effectperiod,2"
		Condition="GAMESTATE:IsHumanPlayer(PLAYER_1) and not GAMESTATE:PlayerUsingBothSides()"
	/>
	
	<layer
		File="easter_eggs/receptor"
		OnCommand="x,PlayerPosP1()-32;y,SCREEN_CENTER_Y-125;diffuseblink;effectcolor1,0,1,0,0.5;effectcolor2,1,0,0,0.5;effectclock,bgm;effectperiod,2"
		Condition="GAMESTATE:IsHumanPlayer(PLAYER_1) and not GAMESTATE:PlayerUsingBothSides()"
	/>
	
	<layer
		File="easter_eggs/receptor"
		OnCommand="x,PlayerPosP1()+32;y,SCREEN_CENTER_Y-125;rotationz,-180;diffuseblink;effectcolor1,1,0,0,0.5;effectcolor2,0,1,0,0.5;effectclock,bgm;effectperiod,2"
		Condition="GAMESTATE:IsHumanPlayer(PLAYER_1) and not GAMESTATE:PlayerUsingBothSides()"
	/>
	
	<layer
		File="easter_eggs/receptor"
		OnCommand="x,PlayerPosP1()+96;y,SCREEN_CENTER_Y-125;rotationz,-90;diffuseblink;effectcolor1,0,1,0,0.5;effectcolor2,1,0,0,0.5;effectclock,bgm;effectperiod,2"
		Condition="GAMESTATE:IsHumanPlayer(PLAYER_1) and not GAMESTATE:PlayerUsingBothSides()"
	/>
	
		<layer
		File="easter_eggs/receptor"
		OnCommand="x,PlayerPosP2()-96;y,SCREEN_CENTER_Y-125;rotationz,-90;diffuseblink;effectcolor1,1,0,0,0.5;effectcolor2,0,1,0,0.5;effectclock,bgm;effectperiod,2"
		Condition="GAMESTATE:IsHumanPlayer(PLAYER_2) and not GAMESTATE:PlayerUsingBothSides()"
	/>
	
	<layer
		File="easter_eggs/receptor"
		OnCommand="x,PlayerPosP2()-32;y,SCREEN_CENTER_Y-125;rotationz,180;diffuseblink;effectcolor1,0,1,0,0.5;effectcolor2,1,0,0,0.5;effectclock,bgm;effectperiod,2"
		Condition="GAMESTATE:IsHumanPlayer(PLAYER_2) and not GAMESTATE:PlayerUsingBothSides()"
	/>
	
	<layer
		File="easter_eggs/receptor"
		OnCommand="x,PlayerPosP2()+32;y,SCREEN_CENTER_Y-125;diffuseblink;effectcolor1,1,0,0,0.5;effectcolor2,0,1,0,0.5;effectclock,bgm;effectperiod,2"
		Condition="GAMESTATE:IsHumanPlayer(PLAYER_2) and not GAMESTATE:PlayerUsingBothSides()"
	/>
	
	<layer
		File="easter_eggs/receptor"
		OnCommand="x,PlayerPosP2()+96;y,SCREEN_CENTER_Y-125;rotationz,90;diffuseblink;effectcolor1,0,1,0,0.5;effectcolor2,1,0,0,0.5;effectclock,bgm;effectperiod,2"
		Condition="GAMESTATE:IsHumanPlayer(PLAYER_2) and not GAMESTATE:PlayerUsingBothSides()"
	/>
	
	<layer
		File="easter_eggs/receptor"
		OnCommand="x,SCREEN_CENTER_X-224;y,SCREEN_CENTER_Y-125;rotationz,90;diffuseblink;effectcolor1,1,0,0,0.5;effectcolor2,0,1,0,0.5;effectclock,bgm;effectperiod,2"
		Condition="GAMESTATE:PlayerUsingBothSides()"
	/>
	
	<layer
		File="easter_eggs/receptor"
		OnCommand="x,SCREEN_CENTER_X-160;y,SCREEN_CENTER_Y-125;diffuseblink;effectcolor1,0,1,0,0.5;effectcolor2,1,0,0,0.5;effectclock,bgm;effectperiod,2"
		Condition="GAMESTATE:PlayerUsingBothSides()"
	/>
	
	<layer
		File="easter_eggs/receptor"
		OnCommand="x,SCREEN_CENTER_X-96;y,SCREEN_CENTER_Y-125;rotationz,-180;diffuseblink;effectcolor1,1,0,0,0.5;effectcolor2,0,1,0,0.5;effectclock,bgm;effectperiod,2"
		Condition="GAMESTATE:PlayerUsingBothSides()"
	/>
	
	<layer
		File="easter_eggs/receptor"
		OnCommand="x,SCREEN_CENTER_X-32;y,SCREEN_CENTER_Y-125;rotationz,-90;diffuseblink;effectcolor1,0,1,0,0.5;effectcolor2,1,0,0,0.5;effectclock,bgm;effectperiod,2"
		Condition="GAMESTATE:PlayerUsingBothSides()"
	/>
	
		<layer
		File="easter_eggs/receptor"
		OnCommand="x,SCREEN_CENTER_X+32;y,SCREEN_CENTER_Y-125;rotationz,-90;diffuseblink;effectcolor1,0,1,0,0.5;effectcolor2,1,0,0,0.5;effectclock,bgm;effectperiod,2"
		Condition="GAMESTATE:PlayerUsingBothSides()"
	/>
	
	<layer
		File="easter_eggs/receptor"
		OnCommand="x,SCREEN_CENTER_X+96;y,SCREEN_CENTER_Y-125;rotationz,180;diffuseblink;effectcolor1,1,0,0,0.5;effectcolor2,0,1,0,0.5;effectclock,bgm;effectperiod,2"
		Condition="GAMESTATE:PlayerUsingBothSides()"
	/>
	
	<layer
		File="easter_eggs/receptor"
		OnCommand="x,SCREEN_CENTER_X+160;y,SCREEN_CENTER_Y-125;diffuseblink;effectcolor1,0,1,0,0.5;effectcolor2,1,0,0,0.5;effectclock,bgm;effectperiod,2"
		Condition="GAMESTATE:PlayerUsingBothSides()"
	/>
	
	<layer
		File="easter_eggs/receptor"
		OnCommand="x,SCREEN_CENTER_X+224;y,SCREEN_CENTER_Y-125;rotationz,90;diffuseblink;effectcolor1,1,0,0,0.5;effectcolor2,0,1,0,0.5;effectclock,bgm;effectperiod,2"
		Condition="GAMESTATE:PlayerUsingBothSides()"
	/>
	
	<layer
		File="easter_eggs/far"
		OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;customtexturerect,0,0,1,1;texcoordvelocity,0.05,-0.30;ZoomToWidth,SCREEN_WIDTH;ZoomToHeight,SCREEN_HEIGHT;diffusealpha,0;linear,1;diffusealpha,1"
	/>
	
	<layer
		File="easter_eggs/med"
		OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;customtexturerect,0,0,1,1;texcoordvelocity,0.10,-0.60;ZoomToWidth,SCREEN_WIDTH;ZoomToHeight,SCREEN_HEIGHT;diffusealpha,0;linear,1;diffusealpha,1"
	/>
	
	<layer
		File="easter_eggs/near"
		OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;customtexturerect,0,0,1,1;texcoordvelocity,0.15,-0.90;ZoomToWidth,SCREEN_WIDTH;ZoomToHeight,SCREEN_HEIGHT;diffusealpha,0;linear,1;diffusealpha,1;sleep,200"
	/>
	</children></ActorFrame>
	
	
	<!--Frost: Credit to Puurokulho and his Napolese chart-->
	<ActorFrame Condition="EasterEggFrost()"><children>

	<!-- Dicks -->

		<Layer
			File="easter_eggs/ice.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;zoom,1.07*gnZoomRatio*gnScaleHeight;diffusealpha,0;croptop,0.9;fadetop,0.1;sleep,0;linear,1;diffusealpha,0.5;linear,4.5;croptop,0;linear,0.1;fadetop,0"
		/>

	<!-- 1 -->
		<Layer
			File="easter_eggs/line1.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+200*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;sleep,0;linear,1;diffusealpha,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line1.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+200*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,0;linear,1;diffusealpha,0;linear,1;diffusealpha,0"
		/>

	<!-- 2 -->

		<Layer
			File="easter_eggs/line2.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+180*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,0.2;linear,1;diffusealpha,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line2.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+180*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,0.2;linear,1;diffusealpha,0;linear,1;diffusealpha,0"
		/>

	<!-- 3 -->

		<Layer
			File="easter_eggs/line3.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+160*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,0.4;linear,1;diffusealpha,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line3.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+160*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,0.4;linear,1;diffusealpha,0;linear,1;diffusealpha,0"
		/>

	<!-- 4 -->

		<Layer
			File="easter_eggs/line4.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+140*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,0.6;linear,1;diffusealpha,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line4.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+140*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,0.6;linear,1;diffusealpha,0;linear,1;diffusealpha,0"
		/>

	<!-- 5 -->

		<Layer
			File="easter_eggs/line5.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+120*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,0.8;linear,1;diffusealpha,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line5.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+120*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,0.8;linear,1;diffusealpha,0;linear,1;diffusealpha,0"
		/>

	<!-- 6 -->

		<Layer
			File="easter_eggs/line6.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+100*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,1;linear,1;diffusealpha,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line6.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+100*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,1;linear,1;diffusealpha,0;linear,1;diffusealpha,0"
		/>

	<!-------------------- ADDFDAFADFADADFADFADFAD -------------------->

	<!-- 7 -->
		<Layer
			File="easter_eggs/line1.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+80*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;sleep,1.2;linear,1;diffusealpha,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line1.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+80*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;sleep,1.2;linear,1;diffusealpha,0;linear,1;diffusealpha,0"
		/>

	<!-- 8 -->

		<Layer
			File="easter_eggs/line2.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+60*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,1.4;linear,1;diffusealpha,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line2.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+60*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,1.4;linear,1;diffusealpha,0;linear,1;diffusealpha,0"
		/>

	<!-- 9 -->

		<Layer
			File="easter_eggs/line3.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+40*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,1.6;linear,1;diffusealpha,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line3.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+40*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,1.6;linear,1;diffusealpha,0;linear,1;diffusealpha,0"
		/>

	<!-- 10 -->

		<Layer
			File="easter_eggs/line4.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+20*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,1.8;linear,1;diffusealpha,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line4.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+20*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,1.8;linear,1;diffusealpha,0;linear,1;diffusealpha,0"
		/>

	<!-- 11 -->

		<Layer
			File="easter_eggs/line5.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,2.0;linear,1;diffusealpha,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line5.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,2.0;linear,1;diffusealpha,0;linear,1;diffusealpha,0"
		/>

	<!-- 12 -->

		<Layer
			File="easter_eggs/line6.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-20*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,2.2;linear,1;diffusealpha,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line6.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-20*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,2.2;linear,1;diffusealpha,0;linear,1;diffusealpha,0"
		/>

	<!-------------------- ADDFDAFADFADADFADFADFAD -------------------->

	<!-- 13 -->
		<Layer
			File="easter_eggs/line1.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-40*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;sleep,2.4;linear,1;diffusealpha,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line1.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-40*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;sleep,2.4;linear,1;diffusealpha,0;linear,1;diffusealpha,0"
		/>

	<!-- 14 -->

		<Layer
			File="easter_eggs/line2.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-60*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,2.6;linear,1;diffusealpha,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line2.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-60*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,2.6;linear,1;diffusealpha,0;linear,1;diffusealpha,0"
		/>

	<!-- 15 -->

		<Layer
			File="easter_eggs/line3.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-80*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,2.8;linear,1;diffusealpha,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line3.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-80*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,2.8;linear,1;diffusealpha,0;linear,1;diffusealpha,0"
		/>

	<!-- 16 -->

		<Layer
			File="easter_eggs/line4.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-100*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,3.0;linear,1;diffusealpha,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line4.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-100*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,3.0;linear,1;diffusealpha,0;linear,1;diffusealpha,0"
		/>

	<!-- 17 -->

		<Layer
			File="easter_eggs/line5.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-120*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,3.2;linear,1;diffusealpha,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line5.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-120*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,3.2;linear,1;diffusealpha,0;linear,1;diffusealpha,0"
		/>

	<!-- 18 -->

		<Layer
			File="easter_eggs/line6.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-140*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,3.4;linear,1;diffusealpha,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line6.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-140*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,3.4;linear,1;diffusealpha,0;linear,1;diffusealpha,0"
		/>

	<!-- 19 -->

		<Layer
			File="easter_eggs/line2.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-180*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,3.6;linear,1;diffusealpha,1;sleep,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line2.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-180*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,3.6;linear,1;diffusealpha,0;sleep,1;linear,1;diffusealpha,0"
		/>

	<!-- 20 -->

		<Layer
			File="easter_eggs/line3.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-200*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,3.8;linear,1;diffusealpha,1;sleep,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line3.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-200*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,3.8;linear,1;diffusealpha,0;sleep,1;linear,1;diffusealpha,0"
		/>

	<!-- 21 -->

		<Layer
			File="easter_eggs/line6.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-220*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,4.0;linear,1;diffusealpha,1;sleep,1;linear,1;diffusealpha,0"
		/>

		<Layer
			File="easter_eggs/line6.png"
			OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-220*gnScaleHeight;zoom,1*gnZoomRatio;diffusealpha,0;diffusealpha,0;sleep,4.0;linear,1;diffusealpha,0;sleep,1;linear,1;diffusealpha,0;sleep,17.923"
		/>
	</children> </ActorFrame>

<!--Snowflake: Credit to Puurokulho and his Napolese Chart-->
<ActorFrame Condition="EasterEggBlizzard()"> <children>

	<Layer Type="Quad"
	InitCommand="sleep,1;queuecommand,Start;"
	StartCommand="%function(self)
					if GAMESTATE:IsHumanPlayer(PLAYER_1) then

						GAMESTATE:ApplyGameCommand('mod,*1 50% Drunk,*1 150% Bumpy,*20 70% Dark',1);
						SCREENMAN:GetTopScreen():GetChild('PlayerP1'):bounce()
						SCREENMAN:GetTopScreen():GetChild('PlayerP1'):effectmagnitude(-20,20,0)
						SCREENMAN:GetTopScreen():GetChild('PlayerP1'):effectclock('bgm')
						SCREENMAN:GetTopScreen():GetChild('PlayerP1'):effectperiod(0.2)
					end
 
					if GAMESTATE:IsHumanPlayer(PLAYER_2) then

						GAMESTATE:ApplyGameCommand('mod,*1 50% Drunk,*1 150% Bumpy,*20 70% Dark',2);
						SCREENMAN:GetTopScreen():GetChild('PlayerP2'):bounce()
						SCREENMAN:GetTopScreen():GetChild('PlayerP2'):effectmagnitude(-20,20,0)
						SCREENMAN:GetTopScreen():GetChild('PlayerP2'):effectclock('bgm')
						SCREENMAN:GetTopScreen():GetChild('PlayerP2'):effectperiod(0.2)
					end
	end"
	/>
	
	<Layer
	File="easter_eggs/blurredsnow.png"
	OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;customtexturerect,0,0,1.5,1.5;texcoordvelocity,2.40,-1.90;ZoomToWidth,SCREEN_WIDTH;ZoomToHeight,SCREEN_HEIGHT;diffusealpha,0;linear,1;diffusealpha,0;bob;linear,1;diffusealpha,1;sleep,20;linear,1;diffusealpha,0"

	/>


	<Layer
	File="easter_eggs/blurredsnow.png"
	OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;customtexturerect,0,0,1,1;texcoordvelocity,1.40,-0.90;ZoomToWidth,SCREEN_WIDTH;ZoomToHeight,SCREEN_HEIGHT;diffusealpha,0;linear,1;diffusealpha,0;bob;linear,1;diffusealpha,1;sleep,20;linear,1;diffusealpha,0"

	/>


	<Layer
	File="easter_eggs/white.png"
	OnCommand="diffusealpha,0;x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;ZoomToWidth,SCREEN_WIDTH;ZoomToHeight,SCREEN_HEIGHT;sleep,1;linear,2;diffusealpha,0;sleep,20;linear,1;diffusealpha,0"

	/>
	
	
	<!--- SNOW --->

		<Layer
		File="easter_eggs/blurredsnow.png"
		OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;customtexturerect,0,0,1,1;texcoordvelocity,1.40,-0.90;ZoomToWidth,SCREEN_WIDTH;ZoomToHeight,SCREEN_HEIGHT;diffusealpha,0;linear,1;diffusealpha,0;bob;linear,1;diffusealpha,1;sleep,20000;linear,1;diffusealpha,0"

		/>


		<Layer
		File="easter_eggs/blurredsnowFar.png"
		OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;customtexturerect,0,0,1,1;texcoordvelocity,1.20,-0.90;ZoomToWidth,SCREEN_WIDTH;ZoomToHeight,SCREEN_HEIGHT;diffusealpha,0;linear,1;diffusealpha,0;bob;linear,1;diffusealpha,1;sleep,20000;linear,1;diffusealpha,0"

		/>


		<Layer
		File="easter_eggs/blurredsnowNear.png"
		OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;customtexturerect,0,0,1,1;texcoordvelocity,1.00,-0.90;ZoomToWidth,SCREEN_WIDTH;ZoomToHeight,SCREEN_HEIGHT;diffusealpha,0;linear,1;diffusealpha,0;bob;linear,1;diffusealpha,1;sleep,20000;linear,1;diffusealpha,0"

		/>





	<!--- OVERLAY --->

		<Layer
		File="easter_eggs/white.png"
		OnCommand="diffusealpha,0;x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;ZoomToWidth,SCREEN_WIDTH;ZoomToHeight,SCREEN_HEIGHT;sleep,1;linear,2;diffusealpha,0.7;sleep,19000.5;linear,1;diffusealpha,0"

		/>
		

	</children> </ActorFrame>


	<!-- Foreground Mods -->
	<!-- Shake -->
	<ActorFrame> <children>
<ActorFrame InitCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-2000;sleep,20000;"
	Condition="gnFGMod == 'Shake'"
><children>
	
	<layer
	Type="Quad"
	StepP1MessageCommand="%function(self)
		SCREENMAN:GetTopScreen():finishtweening();
		Mover = math.random(8,10);
		Guesser = math.random(1,3);
		Negator = math.random(1,2);
		
		if Negator == 1 then
			Multiplier = 1;
			end
		if Negator == 2 then
			Multiplier = -1;
			end
		
		SCREENMAN:GetTopScreen():accelerate(0.05);
		SCREENMAN:GetTopScreen():GetChild('PlayerP1'):accelerate(0.05);

		SCREENMAN:GetTopScreen():GetChild('PlayerP1'):rotationz(Mover*Multiplier);
		
		if Guesser == 1 then
			SCREENMAN:GetTopScreen():addx(Mover*Multiplier);
			end
		if Guesser == 2 then
			SCREENMAN:GetTopScreen():addy(Mover*Multiplier);
			end
		if Guesser == 3 then
			SCREENMAN:GetTopScreen():addx(Mover*Multiplier);
			SCREENMAN:GetTopScreen():addy(Mover*Multiplier);
			end
		
		SCREENMAN:GetTopScreen():decelerate(0.05);
		SCREENMAN:GetTopScreen():GetChild('PlayerP1'):decelerate(0.05);

		SCREENMAN:GetTopScreen():GetChild('PlayerP1'):rotationz(0);
		
		SCREENMAN:GetTopScreen():x(0);
		SCREENMAN:GetTopScreen():y(0);
	end"
	

	
	
StepP2MessageCommand="%function(self)
		SCREENMAN:GetTopScreen():finishtweening();
		Mover = math.random(8,10);
		Guesser = math.random(1,3);
		Negator = math.random(1,2);
		
		if Negator == 1 then
			Multiplier = 1;
			end
		if Negator == 2 then
			Multiplier = -1;
			end
		
		SCREENMAN:GetTopScreen():accelerate(0.05);
		SCREENMAN:GetTopScreen():GetChild('PlayerP2'):accelerate(0.05);

		SCREENMAN:GetTopScreen():GetChild('PlayerP2'):rotationz(Mover*Multiplier);
		
		if not GAMESTATE:IsPlayerEnabled(PLAYER_1) then
			if Guesser == 1 then
				SCREENMAN:GetTopScreen():addx(Mover*Multiplier);
				end
			if Guesser == 2 then
				SCREENMAN:GetTopScreen():addy(Mover*Multiplier);
				end
			if Guesser == 3 then
				SCREENMAN:GetTopScreen():addx(Mover*Multiplier);
				SCREENMAN:GetTopScreen():addy(Mover*Multiplier);
				end
			SCREENMAN:GetTopScreen():decelerate(0.05);
			SCREENMAN:GetTopScreen():x(0);
			SCREENMAN:GetTopScreen():y(0);
			end
			
		SCREENMAN:GetTopScreen():GetChild('PlayerP2'):decelerate(0.05);

		SCREENMAN:GetTopScreen():GetChild('PlayerP2'):rotationz(0);
	
	end"
	/>

	</children>
</ActorFrame>

	<!-- Phase -->
<ActorFrame Condition="gnFGMod == 'Phase'" InitCommand="%function(self) P1Mods = -1; P2Mods = -1; end" OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-2000;sleep,20000;">
	<children>
	
	<Layer
	Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"
	Type="Quad"
	StepP1MessageCommand="%function(self)
	SCREENMAN:GetTopScreen():GetChild('PlayerP1'):wag();
	SCREENMAN:GetTopScreen():GetChild('PlayerP1'):effectmagnitude(1,1,1);
	if GAMESTATE:GetSongBeat() > 0 then
		if P1Mods == 1 then
			GAMESTATE:ApplyGameCommand('mod, *2.5 99% stealth',1);
			GAMESTATE:ApplyGameCommand('mod, *7 no dark',1);
			GAMESTATE:ApplyGameCommand('mod, *2 10% mini',1);

			P1Mods = -1;
			else
			GAMESTATE:ApplyGameCommand('mod, *7 no stealth',1);
			GAMESTATE:ApplyGameCommand('mod, *7 dark',1);
			GAMESTATE:ApplyGameCommand('mod, no mini',1);
			
			P1Mods = 1;
			end
		end
	end"
	/>
	
	<layer
	Condition="GAMESTATE:IsPlayerEnabled(PLAYER_2)"
	Type="Quad"
	StepP2MessageCommand="%function(self)
	SCREENMAN:GetTopScreen():GetChild('PlayerP2'):wag();
	SCREENMAN:GetTopScreen():GetChild('PlayerP2'):effectmagnitude(1,1,1);
	if GAMESTATE:GetSongBeat() > 0 then
		if P2Mods == 1 then
			GAMESTATE:ApplyGameCommand('mod, *2.5 99% stealth',2);
			GAMESTATE:ApplyGameCommand('mod, *7 no dark',2);
			GAMESTATE:ApplyGameCommand('mod, *2 10% mini',2);
			
			P2Mods = -1;
			else
			GAMESTATE:ApplyGameCommand('mod, *7 no stealth',2);
			GAMESTATE:ApplyGameCommand('mod, *7 dark',2);
			GAMESTATE:ApplyGameCommand('mod, no mini',2);
			
			P2Mods = 1;
			end
		end
	end"

	/>	

	</children>
</ActorFrame>
	</children> </ActorFrame>
	
	<!-- Misty -->
<ActorFrame InitCommand="%function(self) MistAlpha = 0; self:sleep(0.1); end" 
	Condition="gnFGMod == 'Misty'"
><children>
	<ActorFrame><children>

	<BitmapText
		File="_eurostile normal"
		Text=" "
		InitCommand="x,320;y,240;playcommand,StartTimer;"
		StartTimerCommand="%function(self)
			MistAlpha = MistAlpha + 0.01;
			if MistAlpha >= 0.9 then
				MistAlpha = 0.9
			end
			self:sleep(0.09);
			self:queuecommand('StartTimer');
		end"
	/>
		
	<BitmapText
		File="_eurostile normal"
		Text=" "
		InitCommand="x,200;y,200;"
		StepP1MessageCommand="%function(self)
			if GAMESTATE:IsPlayerEnabled(PLAYER_2) then
				MistAlpha = MistAlpha - 0.01;
			else
				MistAlpha = MistAlpha - 0.02;
			end
			if MistAlpha <= 0 then
				MistAlpha = 0;
			end
		end"
		StepP2MessageCommand="%function(self)
			if GAMESTATE:IsPlayerEnabled(PLAYER_1) then
				MistAlpha = MistAlpha - 0.01;
			else
				MistAlpha = MistAlpha - 0.02;
			end
			if MistAlpha <= 0 then
				MistAlpha = 0;
			end
		end"
	/>		

	</children></ActorFrame>	
	<ActorFrame Condition="gnFGMod == 'Misty'" InitCommand="sleep,0.1;x,gnScaleWidth" ><children>		
<ActorFrame	InitCommand="%function(self)
			self:diffusealpha(0);
			self:linear(0.2);
			self:diffusealpha(1);
			self:queuecommand('Shifter');
			self:zoom(1*gnZoomRatio);
			end"
			ShifterCommand="%function(self)
			self:x(640*gnScaleWidth);
			self:y(240*gnScaleHeight);
			self:linear(30);
			self:addx(-1280*gnScaleWidth);
			self:queuecommand('Shifter');
			end">
	<children>
			<BitmapText
			File="_eurostile normal"
			Text=" "
			InitCommand="sleep,2000;"
			/>
			
			<layer
				File="Mist.png"
				InitCommand="diffusealpha,0;queuecommand,Alpha;"
				AlphaCommand="%function(self)
					if gnFGMod == 'Misty' then
						self:linear(0.5);
						self:diffusealpha(MistAlpha);
						self:queuecommand('Alpha');
					else
						self:stoptweening();
						self:sleep(0.01);
						self:queuecommand('Alpha');
					end
				end"
			/>
			
			<layer
				File="Mist.png"
				InitCommand="diffusealpha,0;x,1280;queuecommand,Alpha;"
				AlphaCommand="%function(self)
					if gnFGMod == 'Misty' then
						self:linear(0.5);
						self:diffusealpha(MistAlpha);
						self:queuecommand('Alpha');
					else
						self:stoptweening();
						self:sleep(0.01);
						self:queuecommand('Alpha');
					end
				end"
			/>	

	</children></ActorFrame>

<ActorFrame Condition="gnFGMod == 'Misty'"
			InitCommand="%function(self)
				MistAlpha = 0;
				self:zoom(1*gnZoomRatio);
				self:queuecommand('Shifter');
			end"
			ShifterCommand="%function(self)
				self:x(0);
				self:y(240*gnScaleHeight);
				self:linear(30);
				self:addx(1280*gnScaleWidth);
				self:queuecommand('Shifter');
			end"
><children>
			<BitmapText
				File="_eurostile normal"
				Text=" "
				InitCommand="sleep,2000;"
			/>
			
			<layer
				File="Mist.png"
				InitCommand="diffusealpha,0;queuecommand,Alpha;"
				AlphaCommand="%function(self)
					if gnFGMod == 'Misty' then
						self:linear(0.5);
						self:diffusealpha(MistAlpha);
						self:queuecommand('Alpha');
					else
						self:stoptweening();
						self:sleep(0.01);
						self:queuecommand('Alpha');
					end
				end"
			/>
			
			<layer
			File="Mist.png"
			InitCommand="diffusealpha,0;x,-1280;queuecommand,Alpha;"
			AlphaCommand="%function(self)
			if gnFGMod == 'Misty' then
				self:linear(0.5);
				self:diffusealpha(MistAlpha);
				self:queuecommand('Alpha');
				else
				self:stoptweening();
				self:sleep(0.01);
				self:queuecommand('Alpha');
				end
			end
			"
			/>
	

	</children>
</ActorFrame>
</children>
</ActorFrame>

	<ActorFrame
		Condition="gnFGMod == 'Misty'"
	><children>
	
		<layer
			File="clear"
			Condition="GAMESTATE:IsHumanPlayer(PLAYER_1)"
			InitCommand="diffusealpha,0;sleep,1;x,160*gnScaleWidth;;y,240*gnScaleHeight;linear,0.5;diffusealpha,1;sleep,4;linear,0.5;diffusealpha,0;"
		/>
		<layer
			File="clear"
			Condition="GAMESTATE:IsHumanPlayer(PLAYER_2)"
			InitCommand="diffusealpha,0;sleep,1;x,480*gnScaleWidth;;y,240*gnScaleHeight;linear,0.5;diffusealpha,1;sleep,4;linear,0.5;diffusealpha,0;"
		/>
		<layer
			File="step"
			Condition="GAMESTATE:IsHumanPlayer(PLAYER_1)"
			InitCommand="diffusealpha,0;sleep,1;x,160*gnScaleWidth;y,240*gnScaleHeight;playcommand,Checker;"

			CheckerCommand="%function(self)
				if MistAlpha >= 0.65 then
					self:linear(0.5);
					self:diffusealpha(1)
				else
					self:linear(0.5);
					self:diffusealpha(0);
				end
					self:queuecommand('Checker');
				end"
			/>
		<layer
			File="step"
			Condition="GAMESTATE:IsHumanPlayer(PLAYER_2)"
			InitCommand="diffusealpha,0;x,480*gnScaleWidth;y,240*gnScaleHeight;playcommand,Checker;"
			CheckerCommand="%function(self)
				if MistAlpha >= 0.65 then
					self:linear(0.5);
					self:diffusealpha(1)
				else
					self:linear(0.5);
					self:diffusealpha(0);
				end
					self:queuecommand('Checker');
			end"
		/>
	
	</children></ActorFrame>
	</children></ActorFrame>

<!-- Nyan Cat -->

<ActorFrame 
	Condition="gnFGMod == 'Nyan Cat'"
><children>		
		<layer
			File="nyancat.sprite"
			InitCommand="hibernate,3;playcommand,Start;"
			StartCommand="%function(self)
				catsX = 0;
				catsY = 0;
				self:x(0);
				self:y(0);
				self:diffusealpha(0.3);
				catsDir = math.random(1,2);		
				self:playcommand('Runcats');
			end"
			
			RuncatsCommand="%function(self)
			catsY = math.random(40,360);
			self:zoom(0.4);
			if catsDir == 1 then
				catsX = -380;
				self:rotationy(0);
				else
				catsX = 1020;
				self:rotationy(180);
				end
			self:x(catsX*gnScaleWidth);
			self:y(catsY*gnScaleHeight);
			self:linear(7);
			if catsDir == 1 then
				catsDir = 2;
				self:addx(1300*gnScaleWidth);
				else
				catsDir = 1;
				self:addx(-1300*gnScaleWidth);
				end
			self:sleep(1);
			self:queuecommand('Runcats2');
			end"
			
			Runcats2Command="%function(self)
			catsY = math.random(40,360);
			self:zoom(0.4);
			if catsDir == 1 then
				catsX = -380;
				self:rotationy(0);
				else
				catsX = 1020;
				self:rotationy(180);
				end
			self:x(catsX*gnScaleWidth);
			self:y(catsY*gnScaleHeight);
			self:linear(7);
			if catsDir == 1 then
				catsDir = 2;
				self:addx(1300*gnScaleWidth);
				else
				catsDir = 1;
				self:addx(-1300*gnScaleWidth);
				end
			self:sleep(1);
			self:queuecommand('Runcats');
			end"

			/>
			
		<layer
			File="nyancat.sprite"
			InitCommand="hibernate,9;playcommand,Start;"
			StartCommand="%function(self)
			catsX = 0;
			catsY = 0;
			self:x(0);
			self:y(0);
			self:diffusealpha(0.3);
			catsDir = math.random(1,2);
			
			self:playcommand('Runcats');
			end"
			
			RuncatsCommand="%function(self)
			catsY = math.random(40,360);
			self:zoom(0.4);
			if catsDir == 1 then
				catsX = -380;
				self:rotationy(0);
				else
				catsX = 1020;
				self:rotationy(180);
				end
			self:x(catsX*gnScaleWidth);
			self:y(catsY*gnScaleHeight);
			self:linear(7);
			if catsDir == 1 then
				catsDir = 2;
				self:addx(1300*gnScaleWidth);
				else
				catsDir = 1;
				self:addx(-1300*gnScaleWidth);
				end
			self:sleep(1);
			self:queuecommand('Runcats2');
			end"
			
			Runcats2Command="%function(self)
			catsY = math.random(40,360);
			self:zoom(0.4);
			if catsDir == 1 then
				catsX = -380;
				self:rotationy(0);
				else
				catsX = 1020;
				self:rotationy(180);
				end
			self:x(catsX*gnScaleWidth);
			self:y(catsY*gnScaleHeight);
			self:linear(7);
			if catsDir == 1 then
				catsDir = 2;
				self:addx(1300*gnScaleWidth);
				else
				catsDir = 1;
				self:addx(-1300*gnScaleWidth);
				end
			self:sleep(1);
			self:queuecommand('Runcats');
			end"

			/>
			
		<layer
			File="nyancat.sprite"
			InitCommand="hibernate,15;playcommand,Start;"
			StartCommand="%function(self)
			catsX = 0;
			catsY = 0;
			self:x(0);
			self:y(0);
			self:diffusealpha(0.3);
			catsDir = math.random(1,2);
			
			self:playcommand('Runcats');
			end"
			
			RuncatsCommand="%function(self)
			catsY = math.random(40,360);
			self:zoom(0.4);
			if catsDir == 1 then
				catsX = -380;
				self:rotationy(0);
				else
				catsX = 1020;
				self:rotationy(180);
				end
			self:x(catsX*gnScaleWidth);
			self:y(catsY*gnScaleHeight);
			self:linear(7);
			if catsDir == 1 then
				catsDir = 2;
				self:addx(1300*gnScaleWidth);
				else
				catsDir = 1;
				self:addx(-1300*gnScaleWidth);
				end
			self:sleep(1);
			self:queuecommand('Runcats2');
			end"
			
			Runcats2Command="%function(self)
			catsY = math.random(40,360);
			self:zoom(0.4);
			if catsDir == 1 then
				catsX = -380;
				self:rotationy(0);
				else
				catsX = 1020;
				self:rotationy(180);
				end
			self:x(catsX*gnScaleWidth);
			self:y(catsY*gnScaleHeight);
			self:linear(7);
			if catsDir == 1 then
				catsDir = 2;
				self:addx(1300*gnScaleWidth);
				else
				catsDir = 1;
				self:addx(-1300*gnScaleWidth);
				end
			self:sleep(1);
			self:queuecommand('Runcats');
			end"

			/>
			
		<layer
			File="nyancat.sprite"
			InitCommand="hibernate,22;playcommand,Start;"
			StartCommand="%function(self)
			catsX = 0;
			catsY = 0;
			self:x(0);
			self:y(0);
			self:diffusealpha(0.3);
			catsDir = math.random(1,2);
			
			self:playcommand('Runcats');
			end"
			
			RuncatsCommand="%function(self)
			catsY = math.random(40,360);
			self:zoom(0.4);
			if catsDir == 1 then
				catsX = -380;
				self:rotationy(0);
				else
				catsX = 1020;
				self:rotationy(180);
				end
			self:x(catsX*gnScaleWidth);
			self:y(catsY*gnScaleHeight);
			self:linear(7);
			if catsDir == 1 then
				catsDir = 2;
				self:addx(1300*gnScaleWidth);
				else
				catsDir = 1;
				self:addx(-1300*gnScaleWidth);
				end
			self:sleep(1);
			self:queuecommand('Runcats2');
			end"
			
			Runcats2Command="%function(self)
			catsY = math.random(40,360);
			self:zoom(0.4);
			if catsDir == 1 then
				catsX = -380;
				self:rotationy(0);
				else
				catsX = 1020;
				self:rotationy(180);
				end
			self:x(catsX*gnScaleWidth);
			self:y(catsY*gnScaleHeight);
			self:linear(7);
			if catsDir == 1 then
				catsDir = 2;
				self:addx(1300);
				else
				catsDir = 1;
				self:addx(-1300);
				end
			self:sleep(1);
			self:queuecommand('Runcats');
			end"

			/>
			
<layer
			File="nyancat.sprite"
			InitCommand="hibernate,29;playcommand,Start;"
			StartCommand="%function(self)
			catsX = 0;
			catsY = 0;
			self:x(0);
			self:y(0);
			catsDir = math.random(1,2);
			self:playcommand('Runcats');
			end"
			
			RuncatsCommand="%function(self)
			catsY = math.random(40,360);
			self:zoom(0.4);
			if catsDir == 1 then
				catsX = -380;
				self:rotationy(0);
				else
				catsX = 1020;
				self:rotationy(180);
				end
			self:x(catsX*gnScaleWidth);
			self:y(catsY*gnScaleHeight);
			self:linear(7);
			if catsDir == 1 then
				catsDir = 2;
				self:addx(1300*gnScaleWidth);
				else
				catsDir = 1;
				self:addx(-1300*gnScaleWidth);
				end
			self:sleep(1);
			self:queuecommand('Runcats2');
			end"
			
			Runcats2Command="%function(self)
			catsY = math.random(40,360);
			self:zoom(0.4);
			if catsDir == 1 then
				catsX = -380;
				self:rotationy(0);
				else
				catsX = 1020;
				self:rotationy(180);
				end
			self:x(catsX*gnScaleWidth);
			self:y(catsY*gnScaleHeight);
			self:linear(7);
			if catsDir == 1 then
				catsDir = 2;
				self:addx(1300*gnScaleWidth);
				else
				catsDir = 1;
				self:addx(-1300*gnScaleWidth);
				end
			self:sleep(1);
			self:queuecommand('Runcats');
			end"

			/>
			
			
		<layer
			Type="Quad"
			InitCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;zoomto,SCREEN_WIDTH,SCREEN_HEIGHT;diffusealpha,0;rainbow;"
			
			StepP1MessageCommand="%function(self)
					if gnFGMod == 'Nyan Cat' then
					SCREENMAN:GetTopScreen():GetChild('PlayerP1'):wag();
					SCREENMAN:GetTopScreen():GetChild('PlayerP1'):effectmagnitude(1,1,1);
					GAMESTATE:ApplyGameCommand('mod, 10% tipsy',1);
					GAMESTATE:ApplyGameCommand('mod, 10% drunk',1);
					GAMESTATE:ApplyGameCommand('mod, 10% dizzy',1);
					GAMESTATE:ApplyGameCommand('mod, 10% beat',1);
					
					self:stoptweening();
					self:linear(3);
					self:diffusealpha(0.1);
					end
			end"
			
			StepP2MessageCommand="%function(self)
					if gnFGMod == 'Nyan Cat' then
					SCREENMAN:GetTopScreen():GetChild('PlayerP2'):wag();
					SCREENMAN:GetTopScreen():GetChild('PlayerP2'):effectmagnitude(1,1,1);
					GAMESTATE:ApplyGameCommand('mod, -10% tipsy',2);
					GAMESTATE:ApplyGameCommand('mod, -10% drunk',2);
					GAMESTATE:ApplyGameCommand('mod, -10% dizzy',2);
					GAMESTATE:ApplyGameCommand('mod, -10% beat',2);
					
					self:stoptweening();
					self:linear(3);
					self:diffusealpha(0.1);
					end
			end"

			/>

	</children>
</ActorFrame>
	
<!-- Popcorn -->
<ActorFrame Condition="gnFGMod == 'Popcorn'"><children>
		<ActorFrame><children>
			<Layer
				File="blank.png"
				InitCommand="sleep,20000;"
				StepP1MessageCommand="%function(self)
					popTimer = popTimer + 1;
					if popTimer > 6 then
						popTimer = 1;
					end
				end"
				StepP2MessageCommand="%function(self)
					popTimer2 = popTimer2 + 1;
					if popTimer2 > 6 then
						popTimer2 = 1;
					end
				end"
			/>

			<ActorFrame InitCommand="%function(self)
						self:x(2000*gnScaleWidth)
						self:y(SCREEN_CENTER_Y)
						popTimer = 0;
						popTimer2 = 0;
						P1Switch = 0;
						P2Switch = 0;
						P3Switch = 0;
						P4Switch = 0;
						P5Switch = 0;
						P6Switch = 0;
						
						end"
			StepP1MessageCommand="playcommand,Update0"
			Update0Command="%function(self)
			if popTimer == 1 then
				self:diffusealpha(1);
				self:zoom(0.1);
				self:x(-100+(100*math.random(3))+(10*math.random(9))+(1*math.random(9))*gnScaleWidth);
				self:y(10+(100*math.random(2))+(10*math.random(7))+(1*math.random(9))*gnScaleHeight);
				self:decelerate(0.25);
				self:zoom((math.random(2))+(0.1*math.random(9))+(0.01*math.random(9)));
				self:sleep(0.001);
				self:diffusealpha(0);
				else
				if popTimer == 6 then
					self:stoptweening();
					end
				end
			end"> <children>

				<Layer
				File="explosion.png"
				StepP1MessageCommand="playcommand,Update1"
				Update1Command="%function(self)
				if popTimer == 1 then
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer == 6 then
					self:stoptweening();
					end
				end
				end"
		Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"		/>

				<Layer
				File="explosion.png"
				StepP1MessageCommand="playcommand,Update2"
				Update2Command="%function(self)
				if popTimer == 1 then	
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer == 6 then
					self:stoptweening();
					end
				end
				end"
		Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"		/>

				<Layer
				File="popcorn1.png"
				StepP1MessageCommand="x,0;y,0;playcommand,Update3"
				Update3Command="%function(self)
				if popTimer == 1 then
					if P1Switch == 0 then
					Rotit = (100*(math.random(-6,6)));
					Xit = (math.random(-2,2)*((10*math.random(-9,9))+(1*math.random(-9,9))));
					Yit = (-1*(10+(10*math.random(5,9))+(1*math.random(5,9))));
					
					self:diffusealpha(1);
					self:rotationz(Rotit);
					self:decelerate(0.2);
					self:addx(Xit*gnScaleWidth);
					self:addy(Yit*gnScaleHeight);
					self:rotationz(0);
					self:accelerate(0.2);
					
					Rotit = (Rotit * (-1));
					
					self:rotationz(Rotit);
					self:addx(Xit*gnScaleWidth);
					self:addy(600*gnScaleHeight);
					self:sleep(0.001);
					self:diffusealpha(0);
					P1Switch = 1;
					end
				else
				if popTimer == 6 then
					self:stoptweening();
					end
					P1Switch = 0;
					end
				end"
		Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"		/>
				
			</children> </ActorFrame>


			<ActorFrame InitCommand="%function(self)
						self:x(2000*gnScaleWidth)
						self:y(SCREEN_CENTER_Y)
						end"
			StepP1MessageCommand="playcommand,Update0"
			Update0Command="%function(self)
			if popTimer == 2 then
				self:diffusealpha(1);
				self:zoom(0.1);
				self:x(-100+(100*math.random(3))+(10*math.random(9))+(1*math.random(9))*gnScaleWidth);
				self:y(10+(100*math.random(2))+(10*math.random(7))+(1*math.random(9))*gnScaleHeight);
				self:decelerate(0.25);
				self:zoom((math.random(2))+(0.1*math.random(9))+(0.01*math.random(9)));
				self:sleep(0.001);
				self:diffusealpha(0);
				else
				if popTimer == 1 then
					self:stoptweening();
					end
				end
			end"> <children>

				<Layer
				File="explosion.png"
				StepP1MessageCommand="playcommand,Update1"
				Update1Command="%function(self)
				if popTimer == 2 then
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer == 1 then
					self:stoptweening();
					end
				end
				end"
		Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"		/>

				<Layer
				File="explosion.png"
				StepP1MessageCommand="playcommand,Update2"
				Update2Command="%function(self)
				if popTimer == 2 then	
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer == 1 then
					self:stoptweening();
					end
				end
				end"
		Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"		/>

				<Layer
				File="popcorn2.png"
				StepP1MessageCommand="x,0;y,0;playcommand,Update3"
				Update3Command="%function(self)
				if popTimer == 2 then
					if P2Switch == 0 then
					Rotit = (100*(math.random(-6,6)));
					Xit = (math.random(-2,2)*((10*math.random(-9,9))+(1*math.random(-9,9))));
					Yit = (-1*(10+(10*math.random(5,9))+(1*math.random(5,9))));
					
					self:diffusealpha(1);
					self:rotationz(Rotit);
					self:decelerate(0.2);
					self:addx(Xit*gnScaleWidth);
					self:addy(Yit*gnScaleHeight);
					self:rotationz(0);
					self:accelerate(0.2);
					
					Rotit = (Rotit * (-1));
					
					self:rotationz(Rotit);
					self:addx(Xit*gnScaleWidth);
					self:addy(600*gnScaleHeight);
					self:sleep(0.001);
					self:diffusealpha(0);
					P2Switch = 1;
					end
				else
				if popTimer == 1 then
					self:stoptweening();
					end
					P2Switch = 0;
					end
				end"
		Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"		/>
				
			</children> </ActorFrame>


			<ActorFrame InitCommand="%function(self)
						self:x(2000*gnScaleWidth)
						self:y(SCREEN_CENTER_Y)
						end"
			StepP1MessageCommand="playcommand,Update0"
			Update0Command="%function(self)
			if popTimer == 3 then
				self:diffusealpha(1);
				self:zoom(0.1);
				self:x(-100+(100*math.random(3))+(10*math.random(9))+(1*math.random(9))*gnScaleWidth);
				self:y(10+(100*math.random(2))+(10*math.random(7))+(1*math.random(9))*gnScaleHeight);
				self:decelerate(0.25);
				self:zoom((math.random(2))+(0.1*math.random(9))+(0.01*math.random(9)));
				self:sleep(0.001);
				self:diffusealpha(0);
				else
				if popTimer == 2 then
					self:stoptweening();
					end
				end
			end"> <children>

				<Layer
				File="explosion.png"
				StepP1MessageCommand="playcommand,Update1"
				Update1Command="%function(self)
				if popTimer == 3 then
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer == 2 then
					self:stoptweening();
					end
				end
				end"
		Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"		/>

				<Layer
				File="explosion.png"
				StepP1MessageCommand="playcommand,Update2"
				Update2Command="%function(self)
				if popTimer == 3 then	
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer == 2 then
					self:stoptweening();
					end
				end
				end"
		Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"		/>

				<Layer
				File="popcorn3.png"
				StepP1MessageCommand="x,0;y,0;playcommand,Update3"
				Update3Command="%function(self)
				if popTimer == 3 then
					if P3Switch == 0 then
					Rotit = (100*(math.random(-6,6)));
					Xit = (math.random(-2,2)*((10*math.random(-9,9))+(1*math.random(-9,9))));
					Yit = (-1*(10+(10*math.random(5,9))+(1*math.random(5,9))));
					
					self:diffusealpha(1);
					self:rotationz(Rotit);
					self:decelerate(0.2);
					self:addx(Xit*gnScaleWidth);
					self:addy(Yit*gnScaleHeight);
					self:rotationz(0);
					self:accelerate(0.2);
					
					Rotit = (Rotit * (-1));
					
					self:rotationz(Rotit);
					self:addx(Xit*gnScaleWidth);
					self:addy(600*gnScaleHeight);
					self:sleep(0.001);
					self:diffusealpha(0);
					P3Switch = 1;
					end
				else
				if popTimer == 2 then
					self:stoptweening();
					end
					P3Switch = 0;
					end
				end"
		Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"		/>
				
			</children> </ActorFrame>
			

			<ActorFrame InitCommand="%function(self)
						self:x(2000*gnScaleWidth)
						self:y(SCREEN_CENTER_Y)
						end"
			StepP1MessageCommand="playcommand,Update0"
			Update0Command="%function(self)
			if popTimer == 4 then
				self:diffusealpha(1);
				self:zoom(0.1);
				self:x(-100+(100*math.random(3))+(10*math.random(9))+(1*math.random(9))*gnScaleWidth);
				self:y(10+(100*math.random(2))+(10*math.random(7))+(1*math.random(9))*gnScaleHeight);
				self:decelerate(0.25);
				self:zoom((math.random(2))+(0.1*math.random(9))+(0.01*math.random(9)));
				self:sleep(0.001);
				self:diffusealpha(0);
				else
				if popTimer == 3 then
					self:stoptweening();
					end
				end
			end"> <children>

				<Layer
				File="explosion.png"
				StepP1MessageCommand="playcommand,Update1"
				Update1Command="%function(self)
				if popTimer == 4 then
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer == 3 then
					self:stoptweening();
					end
				end
				end"
		Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"		/>

				<Layer
				File="explosion.png"
				StepP1MessageCommand="playcommand,Update2"
				Update2Command="%function(self)
				if popTimer == 4 then	
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer == 3 then
					self:stoptweening();
					end
				end
				end"
		Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"		/>

				<Layer
				File="popcorn4.png"
				StepP1MessageCommand="x,0;y,0;playcommand,Update3"
				Update3Command="%function(self)
				if popTimer == 4 then
					if P4Switch == 0 then
					Rotit = (100*(math.random(-6,6)));
					Xit = (math.random(-2,2)*((10*math.random(-9,9))+(1*math.random(-9,9))));
					Yit = (-1*(10+(10*math.random(5,9))+(1*math.random(5,9)))*gnScaleHeight);
					
					self:diffusealpha(1);
					self:rotationz(Rotit);
					self:decelerate(0.2);
					self:addx(Xit*gnScaleWidth);
					self:addy(Yit*gnScaleHeight);
					self:rotationz(0);
					self:accelerate(0.2);
					
					Rotit = (Rotit * (-1));
					
					self:rotationz(Rotit);
					self:addx(Xit*gnScaleWidth);
					self:addy(600*gnScaleHeight);
					self:sleep(0.001);
					self:diffusealpha(0);
					P4Switch = 1;
					end
				else
				if popTimer == 3 then
					self:stoptweening();
					end
					P4Switch = 0;
					end
				end"
		Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"		/>
				
			</children> </ActorFrame>


			<ActorFrame InitCommand="%function(self)
						self:x(2000*gnScaleWidth)
						self:y(SCREEN_CENTER_Y)
						end"
			StepP1MessageCommand="playcommand,Update0"
			Update0Command="%function(self)
			if popTimer == 5 then
				self:diffusealpha(1);
				self:zoom(0.1);
				self:x(-100+(100*math.random(3))+(10*math.random(9))+(1*math.random(9))*gnScaleWidth);
				self:y(10+(100*math.random(2))+(10*math.random(7))+(1*math.random(9)));
				self:decelerate(0.25);
				self:zoom((math.random(2))+(0.1*math.random(9))+(0.01*math.random(9)));
				self:sleep(0.001);
				self:diffusealpha(0);
				else
				if popTimer == 4 then
					self:stoptweening();
					end
				end
			end"> <children>

				<Layer
				File="explosion.png"
				StepP1MessageCommand="playcommand,Update1"
				Update1Command="%function(self)
				if popTimer == 5 then
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer == 4 then
					self:stoptweening();
					end
				end
				end"
		Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"		/>

				<Layer
				File="explosion.png"
				StepP1MessageCommand="playcommand,Update2"
				Update2Command="%function(self)
				if popTimer == 5 then	
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer == 4 then
					self:stoptweening();
					end
				end
				end"
		Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"		/>

				<Layer
				File="popcorn5.png"
				StepP1MessageCommand="x,0;y,0;playcommand,Update3"
				Update3Command="%function(self)
				if popTimer == 5 then
					if P5Switch == 0 then
					Rotit = (100*(math.random(-6,6)));
					Xit = (math.random(-2,2)*((10*math.random(-9,9))+(1*math.random(-9,9))));
					Yit = (-1*(10+(10*math.random(5,9))+(1*math.random(5,9))));
					
					self:diffusealpha(1);
					self:rotationz(Rotit);
					self:decelerate(0.2);
					self:addx(Xit*gnScaleWidth);
					self:addy(Yit*gnScaleHeight);
					self:rotationz(0);
					self:accelerate(0.2);
					
					Rotit = (Rotit * (-1));
					
					self:rotationz(Rotit);
					self:addx(Xit*gnScaleWidth);
					self:addy(600*gnScaleHeight);
					self:sleep(0.001);
					self:diffusealpha(0);
					P5Switch = 1;
					end
				else
				if popTimer == 4 then
					self:stoptweening();
					end
					P5Switch = 0;
					end
				end"
		Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"		/>
				
			</children> </ActorFrame>


			<ActorFrame InitCommand="%function(self)
						self:x(2000*gnScaleWidth)
						self:y(SCREEN_CENTER_Y)
						end"
			StepP1MessageCommand="playcommand,Update0"
			Update0Command="%function(self)
			if popTimer == 6 then
				self:diffusealpha(1);
				self:zoom(0.1);
				self:x(-100+(100*math.random(3))+(10*math.random(9))+(1*math.random(9))*gnScaleWidth);
				self:y(10+(100*math.random(2))+(10*math.random(7))+(1*math.random(9))*gnScaleHeight);
				self:decelerate(0.25);
				self:zoom((math.random(2))+(0.1*math.random(9))+(0.01*math.random(9)));
				self:sleep(0.001);
				self:diffusealpha(0);
				else
				if popTimer == 5 then
					self:stoptweening();
					end
				end
			end"> <children>

				<Layer
				File="explosion.png"
				StepP1MessageCommand="playcommand,Update1"
				Update1Command="%function(self)
				if popTimer == 6 then
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer == 5 then
					self:stoptweening();
					end
				end
				end"
		Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"		/>

				<Layer
				File="explosion.png"
				StepP1MessageCommand="playcommand,Update2"
				Update2Command="%function(self)
				if popTimer == 6 then	
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer == 5 then
					self:stoptweening();
					end
				end
				end"
		Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"		/>

				<Layer
				File="popcorn6.png"
				StepP1MessageCommand="x,0;y,0;playcommand,Update3"
				Update3Command="%function(self)
				if popTimer == 6 then
					if P6Switch == 0 then
					Rotit = (100*(math.random(-6,6)));
					Xit = (math.random(-2,2)*((10*math.random(-9,9))+(1*math.random(-9,9))));
					Yit = (-1*(10+(10*math.random(5,9))+(1*math.random(5,9))));
					
					self:diffusealpha(1);
					self:rotationz(Rotit);
					self:decelerate(0.2);
					self:addx(Xit*gnScaleWidth);
					self:addy(Yit*gnScaleHeight);
					self:rotationz(0);
					self:accelerate(0.2);
					
					Rotit = (Rotit * (-1));
					
					self:rotationz(Rotit);
					self:addx(Xit*gnScaleWidth);
					self:addy(600*gnScaleHeight);
					self:sleep(0.001);
					self:diffusealpha(0);
					P6Switch = 1;
					end
				else
				if popTimer == 5 then
					self:stoptweening();
					end
					P6Switch = 0;
					end
				end"
		Condition="GAMESTATE:IsPlayerEnabled(PLAYER_1)"		/>
				
			</children> </ActorFrame>
			
			<ActorFrame InitCommand="%function(self)
						self:x(2000*gnScaleWidth)
						self:y(SCREEN_CENTER_Y)
						popTimer2 = 0;
						popTimer2 = 0;
						P1Switch2 = 0;
						P2Switch2 = 0;
						P3Switch2 = 0;
						P4Switch2 = 0;
						P5Switch2 = 0;
						P6Switch2 = 0;
						
						end"
			StepP2MessageCommand="playcommand,Update0"
			Update0Command="%function(self)
			if popTimer2 == 1 then
				self:diffusealpha(1);
				self:zoom(0.1);
				self:x(-100+(100*math.random(3))+(10*math.random(9))+(1*math.random(9))*gnScaleWidth);
				self:addx(320*gnScaleWidth);
				self:y(10+(100*math.random(2))+(10*math.random(7))+(1*math.random(9))*gnScaleHeight);
				self:decelerate(0.25);
				self:zoom((math.random(2))+(0.1*math.random(9))+(0.01*math.random(9)));
				self:sleep(0.001);
				self:diffusealpha(0);
				else
				if popTimer2 == 6 then
					self:stoptweening();
					end
				end
			end"> <children>

				<Layer
				File="explosion.png"
				StepP2MessageCommand="playcommand,Update1"
				Update1Command="%function(self)
				if popTimer2 == 1 then
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer2 == 6 then
					self:stoptweening();
					end
				end
				end"
		Condition="(GAMESTATE:IsPlayerEnabled(PLAYER_2))"		/>

				<Layer
				File="explosion.png"
				StepP2MessageCommand="playcommand,Update2"
				Update2Command="%function(self)
				if popTimer2 == 1 then	
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer2 == 6 then
					self:stoptweening();
					end
				end
				end"
		Condition="(GAMESTATE:IsPlayerEnabled(PLAYER_2))"		/>

				<Layer
				File="popcorn1.png"
				StepP2MessageCommand="x,0;y,0;playcommand,Update3"
				Update3Command="%function(self)
				if popTimer2 == 1 then
					if P1Switch2 == 0 then
					Rotit = (100*(math.random(-6,6)));
					Xit = (math.random(-2,2)*((10*math.random(-9,9))+(1*math.random(-9,9))));
					Yit = (-1*(10+(10*math.random(5,9))+(1*math.random(5,9))));
					
					self:diffusealpha(1);
					self:rotationz(Rotit);
					self:decelerate(0.2);
					self:addx(Xit*gnScaleWidth);
					self:addy(Yit*gnScaleHeight);
					self:rotationz(0);
					self:accelerate(0.2);
					
					Rotit = (Rotit * (-1));
					
					self:rotationz(Rotit);
					self:addx(Xit*gnScaleWidth);
					self:addy(600*gnScaleHeight);
					self:sleep(0.001);
					self:diffusealpha(0);
					P1Switch2 = 1;
					end
				else
				if popTimer2 == 6 then
					self:stoptweening();
					end
					P1Switch2 = 0;
					end
				end"
		Condition="(GAMESTATE:IsPlayerEnabled(PLAYER_2))"		/>
				
			</children> </ActorFrame>


			<ActorFrame InitCommand="%function(self)
						self:x(2000*gnScaleWidth)
						self:y(SCREEN_CENTER_Y)
						end"
			StepP2MessageCommand="playcommand,Update0"
			Update0Command="%function(self)
			if popTimer2 == 2 then
				self:diffusealpha(1);
				self:zoom(0.1);
				self:x(-100+(100*math.random(3))+(10*math.random(9))+(1*math.random(9))*gnScaleWidth);
				self:addx(320*gnScaleWidth);
				self:y(10+(100*math.random(2))+(10*math.random(7))+(1*math.random(9))*gnScaleHeight);
				self:decelerate(0.25);
				self:zoom((math.random(2))+(0.1*math.random(9))+(0.01*math.random(9)));
				self:sleep(0.001);
				self:diffusealpha(0);
				else
				if popTimer2 == 1 then
					self:stoptweening();
					end
				end
			end"> <children>

				<Layer
				File="explosion.png"
				StepP2MessageCommand="playcommand,Update1"
				Update1Command="%function(self)
				if popTimer2 == 2 then
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer2 == 1 then
					self:stoptweening();
					end
				end
				end"
		Condition="(GAMESTATE:IsPlayerEnabled(PLAYER_2))"		/>

				<Layer
				File="explosion.png"
				StepP2MessageCommand="playcommand,Update2"
				Update2Command="%function(self)
				if popTimer2 == 2 then	
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer2 == 1 then
					self:stoptweening();
					end
				end
				end"
		Condition="(GAMESTATE:IsPlayerEnabled(PLAYER_2))"		/>

				<Layer
				File="popcorn2.png"
				StepP2MessageCommand="x,0;y,0;playcommand,Update3"
				Update3Command="%function(self)
				if popTimer2 == 2 then
					if P2Switch2 == 0 then
					Rotit = (100*(math.random(-6,6)));
					Xit = (math.random(-2,2)*((10*math.random(-9,9))+(1*math.random(-9,9))));
					Yit = (-1*(10+(10*math.random(5,9))+(1*math.random(5,9))));
					
					self:diffusealpha(1);
					self:rotationz(Rotit);
					self:decelerate(0.2);
					self:addx(Xit*gnScaleWidth);
					self:addy(Yit*gnScaleHeight);
					self:rotationz(0);
					self:accelerate(0.2);
					
					Rotit = (Rotit * (-1));
					
					self:rotationz(Rotit);
					self:addx(Xit*gnScaleWidth);
					self:addy(600*gnScaleHeight);
					self:sleep(0.001);
					self:diffusealpha(0);
					P2Switch2 = 1;
					end
				else
				if popTimer2 == 1 then
					self:stoptweening();
					end
					P2Switch2 = 0;
					end
				end"
		Condition="(GAMESTATE:IsPlayerEnabled(PLAYER_2))"		/>
				
			</children> </ActorFrame>


			<ActorFrame InitCommand="%function(self)
						
						self:x(2000*gnScaleWidth)
						self:y(SCREEN_CENTER_Y)
						end"
			StepP2MessageCommand="playcommand,Update0"
			Update0Command="%function(self)
			if popTimer2 == 3 then
				self:diffusealpha(1);
				self:zoom(0.1);
				self:x(-100+(100*math.random(3))+(10*math.random(9))+(1*math.random(9))*gnScaleWidth);
				self:addx(320*gnScaleWidth);
				self:y(10+(100*math.random(2))+(10*math.random(7))+(1*math.random(9))*gnScaleHeight);
				self:decelerate(0.25);
				self:zoom((math.random(2))+(0.1*math.random(9))+(0.01*math.random(9)));
				self:sleep(0.001);
				self:diffusealpha(0);
				else
				if popTimer2 == 2 then
					self:stoptweening();
					end
				end
			end"> <children>

				<Layer
				File="explosion.png"
				StepP2MessageCommand="playcommand,Update1"
				Update1Command="%function(self)
				if popTimer2 == 3 then
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer2 == 2 then
					self:stoptweening();
					end
				end
				end"
		Condition="(GAMESTATE:IsPlayerEnabled(PLAYER_2))"		/>

				<Layer
				File="explosion.png"
				StepP2MessageCommand="playcommand,Update2"
				Update2Command="%function(self)
				if popTimer2 == 3 then	
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer2 == 2 then
					self:stoptweening();
					end
				end
				end"
		Condition="(GAMESTATE:IsPlayerEnabled(PLAYER_2))"		/>

				<Layer
				File="popcorn3.png"
				StepP2MessageCommand="x,0;y,0;playcommand,Update3"
				Update3Command="%function(self)
				if popTimer2 == 3 then
					if P3Switch2 == 0 then
					Rotit = (100*(math.random(-6,6)));
					Xit = (math.random(-2,2)*((10*math.random(-9,9))+(1*math.random(-9,9))));
					Yit = (-1*(10+(10*math.random(5,9))+(1*math.random(5,9))));
					
					self:diffusealpha(1);
					self:rotationz(Rotit);
					self:decelerate(0.2);
					self:addx(Xit*gnScaleWidth);
					self:addy(Yit*gnScaleHeight);
					self:rotationz(0);
					self:accelerate(0.2);
					
					Rotit = (Rotit * (-1));
					
					self:rotationz(Rotit);
					self:addx(Xit*gnScaleWidth);
					self:addy(600*gnScaleHeight);
					self:sleep(0.001);
					self:diffusealpha(0);
					P3Switch2 = 1;
					end
				else
				if popTimer2 == 2 then
					self:stoptweening();
					end
					P3Switch2 = 0;
					end
				end"
		Condition="(GAMESTATE:IsPlayerEnabled(PLAYER_2))"		/>
				
			</children> </ActorFrame>
			

			<ActorFrame InitCommand="%function(self)
						
						self:x(2000*gnScaleWidth)
						self:y(SCREEN_CENTER_Y)
						end"
			StepP2MessageCommand="playcommand,Update0"
			Update0Command="%function(self)
			if popTimer2 == 4 then
				self:diffusealpha(1);
				self:zoom(0.1);
				self:x(-100+(100*math.random(3))+(10*math.random(9))+(1*math.random(9))*gnScaleWidth);
				self:addx(320*gnScaleWidth);
				self:y(10+(100*math.random(2))+(10*math.random(7))+(1*math.random(9))*gnScaleHeight);
				self:decelerate(0.25);
				self:zoom((math.random(2))+(0.1*math.random(9))+(0.01*math.random(9)));
				self:sleep(0.001);
				self:diffusealpha(0);
				else
				if popTimer2 == 3 then
					self:stoptweening();
					end
				end
			end"> <children>

				<Layer
				File="explosion.png"
				StepP2MessageCommand="playcommand,Update1"
				Update1Command="%function(self)
				if popTimer2 == 4 then
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer2 == 3 then
					self:stoptweening();
					end
				end
				end"
		Condition="(GAMESTATE:IsPlayerEnabled(PLAYER_2))"		/>

				<Layer
				File="explosion.png"
				StepP2MessageCommand="playcommand,Update2"
				Update2Command="%function(self)
				if popTimer2 == 4 then	
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer2 == 3 then
					self:stoptweening();
					end
				end
				end"
		Condition="(GAMESTATE:IsPlayerEnabled(PLAYER_2))"		/>

				<Layer
				File="popcorn4.png"
				StepP2MessageCommand="x,0;y,0;playcommand,Update3"
				Update3Command="%function(self)
				if popTimer2 == 4 then
					if P4Switch2 == 0 then
					Rotit = (100*(math.random(-6,6)));
					Xit = (math.random(-2,2)*((10*math.random(-9,9))+(1*math.random(-9,9))));
					Yit = (-1*(10+(10*math.random(5,9))+(1*math.random(5,9))));
					
					self:diffusealpha(1);
					self:rotationz(Rotit);
					self:decelerate(0.2);
					self:addx(Xit*gnScaleWidth);
					self:addy(Yit*gnScaleHeight);
					self:rotationz(0);
					self:accelerate(0.2);
					
					Rotit = (Rotit * (-1));
					
					self:rotationz(Rotit);
					self:addx(Xit*gnScaleWidth);
					self:addy(600*gnScaleHeight);
					self:sleep(0.001);
					self:diffusealpha(0);
					P4Switch2 = 1;
					end
				else
				if popTimer2 == 3 then
					self:stoptweening();
					end
					P4Switch2 = 0;
					end
				end"
		Condition="(GAMESTATE:IsPlayerEnabled(PLAYER_2))"		/>
				
			</children> </ActorFrame>


			<ActorFrame InitCommand="%function(self)
						
						self:x(2000*gnScaleWidth)
						self:y(SCREEN_CENTER_Y)
						end"
			StepP2MessageCommand="playcommand,Update0"
			Update0Command="%function(self)
			if popTimer2 == 5 then
				self:diffusealpha(1);
				self:zoom(0.1);
				self:x(-100+(100*math.random(3))+(10*math.random(9))+(1*math.random(9))*gnScaleWidth);
				self:addx(320*gnScaleWidth);
				self:y(10+(100*math.random(2))+(10*math.random(7))+(1*math.random(9))*gnScaleHeight);
				self:decelerate(0.25);
				self:zoom((math.random(2))+(0.1*math.random(9))+(0.01*math.random(9)));
				self:sleep(0.001);
				self:diffusealpha(0);
				else
				if popTimer2 == 4 then
					self:stoptweening();
					end
				end
			end"> <children>

				<Layer
				File="explosion.png"
				StepP2MessageCommand="playcommand,Update1"
				Update1Command="%function(self)
				if popTimer2 == 5 then
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer2 == 4 then
					self:stoptweening();
					end
				end
				end"
		Condition="(GAMESTATE:IsPlayerEnabled(PLAYER_2))"		/>

				<Layer
				File="explosion.png"
				StepP2MessageCommand="playcommand,Update2"
				Update2Command="%function(self)
				if popTimer2 == 5 then	
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer2 == 4 then
					self:stoptweening();
					end
				end
				end"
		Condition="(GAMESTATE:IsPlayerEnabled(PLAYER_2))"		/>

				<Layer
				File="popcorn5.png"
				StepP2MessageCommand="x,0;y,0;playcommand,Update3"
				Update3Command="%function(self)
				if popTimer2 == 5 then
					if P5Switch2 == 0 then
					Rotit = (100*(math.random(-6,6)));
					Xit = (math.random(-2,2)*((10*math.random(-9,9))+(1*math.random(-9,9))));
					Yit = (-1*(10+(10*math.random(5,9))+(1*math.random(5,9))));
					
					self:diffusealpha(1);
					self:rotationz(Rotit);
					self:decelerate(0.2);
					self:addx(Xit*gnScaleWidth);
					self:addy(Yit*gnScaleHeight);
					self:rotationz(0);
					self:accelerate(0.2);
					
					Rotit = (Rotit * (-1));
					
					self:rotationz(Rotit);
					self:addx(Xit*gnScaleWidth);
					self:addy(600*gnScaleHeight);
					self:sleep(0.001);
					self:diffusealpha(0);
					P5Switch2 = 1;
					end
				else
				if popTimer2 == 4 then
					self:stoptweening();
					end
					P5Switch2 = 0;
					end
				end"
		Condition="(GAMESTATE:IsPlayerEnabled(PLAYER_2))"		/>
				
			</children> </ActorFrame>


			<ActorFrame InitCommand="%function(self)
						
						self:x(2000*gnScaleWidth)
						self:y(SCREEN_CENTER_Y)
						end"
			StepP2MessageCommand="playcommand,Update0"
			Update0Command="%function(self)
			if popTimer2 == 6 then
				self:diffusealpha(1);
				self:zoom(0.1);
				self:x(-100+(100*math.random(3))+(10*math.random(9))+(1*math.random(9))*gnScaleWidth);
				self:addx(320*gnScaleWidth);
				self:y(10+(100*math.random(2))+(10*math.random(7))+(1*math.random(9))*gnScaleHeight);
				self:decelerate(0.25);
				self:zoom((math.random(2))+(0.1*math.random(9))+(0.01*math.random(9)));
				self:sleep(0.001);
				self:diffusealpha(0);
				else
				if popTimer2 == 5 then
					self:stoptweening();
					end
				end
			end"> <children>

				<Layer
				File="explosion.png"
				StepP2MessageCommand="playcommand,Update1"
				Update1Command="%function(self)
				if popTimer2 == 6 then
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer2 == 5 then
					self:stoptweening();
					end
				end
				end"
		Condition="(GAMESTATE:IsPlayerEnabled(PLAYER_2))"		/>

				<Layer
				File="explosion.png"
				StepP2MessageCommand="playcommand,Update2"
				Update2Command="%function(self)
				if popTimer2 == 6 then	
					self:diffusealpha(1);
					self:rotationz(100*(math.random(-6,6)));
					self:decelerate(0.25);
					self:rotationz(0);
					self:diffusealpha(0);
				else
				if popTimer2 == 5 then
					self:stoptweening();
					end
				end
				end"
		Condition="(GAMESTATE:IsPlayerEnabled(PLAYER_2))"		/>

				<Layer
				File="popcorn6.png"
				StepP2MessageCommand="x,0;y,0;playcommand,Update3"
				Update3Command="%function(self)
				if popTimer2 == 6 then
					if P6Switch2 == 0 then
					Rotit = (100*(math.random(-6,6)));
					Xit = (math.random(-2,2)*((10*math.random(-9,9))+(1*math.random(-9,9))));
					Yit = (-1*(10+(10*math.random(5,9))+(1*math.random(5,9))));
					
					self:diffusealpha(1);
					self:rotationz(Rotit);
					self:decelerate(0.2);
					self:addx(Xit*gnScaleWidth);
					self:addy(Yit*gnScaleHeight);
					self:rotationz(0);
					self:accelerate(0.2);
					
					Rotit = (Rotit * (-1));
					
					self:rotationz(Rotit);
					self:addx(Xit*gnScaleWidth);
					self:addy(600*gnScaleHeight);
					self:sleep(0.001);
					self:diffusealpha(0);
					P6Switch2 = 1;
					end
				else
				if popTimer2 == 5 then
					self:stoptweening();
					end
					P6Switch2 = 0;
					end
				end"
		Condition="(GAMESTATE:IsPlayerEnabled(PLAYER_2))"		/>
				
			</children> </ActorFrame>
			
		</children> </ActorFrame>

</children></ActorFrame>

	
<!--Screen Transition-->
	<Layer Type="Quad" InitCommand="diffusealpha,0;" ScreenTransitionMessageCommand="%function(self) ScreenTransitionWhoosh('in'); end" />
	
	<Layer Type="Quad"
	OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;zoomx,SCREEN_WIDTH;zoomy,SCREEN_HEIGHT;diffuse,1,1,1,0;"
	QuadFlickerMessageCommand="@'x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;zoomx,SCREEN_WIDTH*2;zoomy,SCREEN_HEIGHT*2;diffuse,1,1,1,1;diffusealpha,0.1;linear,0.1;diffusealpha,0;'"
	/>
	
	<Layer Type="Quad"
	Condition="not GAMESTATE:IsCourseMode();"
	OnCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;zoomx,SCREEN_WIDTH;zoomy,SCREEN_HEIGHT;diffuse,0,0,0,1;linear,0.3;diffusealpha,0;"
	ScreenTransitionMessageCommand="x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y;zoomx,SCREEN_WIDTH;zoomy,SCREEN_HEIGHT;diffuse,0,0,0,0;linear,0.3;diffusealpha,1;"
	/>
	
	<Layer Type="Quad"
	OnCommand="diffusealpha,0;"
	ScreenTransitionMessageCommand="zoomx,SCREEN_WIDTH;zoomy,SCREEN_HEIGHT;diffuse,0,0,0,1;x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+SCREEN_HEIGHT;draworder,10000;accelerate,0.2;diffuse,0,0,0,1;y,SCREEN_CENTER_Y+(SCREEN_HEIGHT/2)"
	/>
	
	<Layer Type="Quad"
	OnCommand="diffusealpha,0;"
	ScreenTransitionMessageCommand="zoomx,SCREEN_WIDTH;zoomy,SCREEN_HEIGHT;diffuse,0,0,0,1;x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y-SCREEN_HEIGHT;draworder,10000;decelerate,0.2;diffuse,0,0,0,1;y,SCREEN_CENTER_Y-(SCREEN_HEIGHT/2)"
	/>
	
	<Layer File="../../Graphics/TransitionArrow"
	OnCommand="diffusealpha,0;"
	NoRestartMessageCommand="diffusealpha,1;x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+SCREEN_HEIGHT+50;draworder,10000;accelerate,0.2;y,SCREEN_CENTER_Y;decelerate,0.1;zoomx,1.1;zoomy,0.9;addy,5;accelerate,0.1;zoomx,0.95;zoomy,1.05;addy,-6;linear,0.1;zoomx,1;zoomy,1;addy,1;sleep,0.7;decelerate,0.1;zoomx,1.1;zoomy,0.9;addy,5;accelerate,0.1;zoomx,0.95;zoomy,1.05;addy,-6;linear,0.1;zoomx,1;zoomy,1;addy,1;"
	ScreenTransitionMessageCommand="diffusealpha,1;x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+SCREEN_HEIGHT+50;draworder,10000;accelerate,0.2;y,SCREEN_CENTER_Y"
	/>
	
	<Layer File="Restarting" 
	Condition="GAMESTATE:IsEventMode() and MenuButtonGiveUp() and not GAMESTATE:IsCourseMode()"
	OnCommand="diffusealpha,0;"
	NoRestartMessageCommand="hibernate,100;"
	ScreenTransitionMessageCommand="%function(self)
	self:sleep(0.1);
	self:queuecommand('PlaySound');
	end"
	PlaySoundCommand="%function(self)
	if gnSongElapsedPercent > gnLowestRestartPercent and gnSongElapsedPercent < gnHighestRestartPercent then
		local Path = THEME:GetPath( EC_SOUNDS, '', '_save');
		SOUND:PlayOnce(Path);
		MESSAGEMAN:Broadcast('QuadFlicker');
		self:queuecommand('Blink');
		end
	end" 
	BlinkCommand="diffusealpha,1;x,SCREEN_CENTER_X;y,SCREEN_CENTER_Y+SCREEN_HEIGHT+65;draworder,10000;accelerate,0.1;y,SCREEN_CENTER_Y+65;diffusealpha,1;sleep,0.195;diffusealpha,0;sleep,0.195;diffusealpha,1;sleep,0.195;diffusealpha,0;sleep,0.195;diffusealpha,1;sleep,0.195;diffusealpha,0;sleep,0.195;diffusealpha,1;sleep,0.195;diffusealpha,0;sleep,0.195;diffusealpha,1;"
	MenuBackMessageCommand="hidden,1;"
	/>
	
</children> </ActorFrame>

